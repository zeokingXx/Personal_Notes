# Cyber security

## Windows操作系统

### windows账号类型

Window操作系统用户分三种：

- 管理员用户（Administrator）：拥有对计算机的最高级别的操作权力和权限,拥有对计算机的完全控制，不受任何限制（包括来自用户账户控制的限制)，而且可以创建新的用户账户和组账户，并为账户分配权力和权限
- 标准用户：可以完成大量常规操作，但是不能进行可能影响操作系统稳定和安全的操作
- 来宾用户（Guest）：为了便于没有为其分配用户账户的用户临时使用计算机而使用的账户，可以不需要用户账号和密码的情况下登录操作系统，但执行的操作很有限，如无法安装硬件和应用程序，也无法访问个人文件夹以及更改系统设置

**注：Guest和Administrator用户是Win10及早期版本中内建的用户账户，在Win10中默认为禁用状态，而且用户不能删除系统内建的用户账户。**

### 系统内置组账户

为了方便为用户创建的用户账户设置权力和权限，系统内建了大量的组账户，用户可以使用其中一些组账户。

而另一些组账户则只能由系统使用，用于完成系统任务，用户不能删除系统内建的组账户。

| **Administrators**      | **Anonymous Logon** | **Backup Operators** |
| ----------------------- | ------------------- | -------------------- |
| **Authenticated Users** | **Everyone**        | **Guests**           |
| **Local Service**       | **Local System**    | **Network**          |
| **Network Service**     | **Owner Rights**    | **Users**            |
| **Power User**          |                     |                      |

### 账户SID

​	SID是操作系统中每个账户的"身份证明"，无论什么账户都只有唯一的SID。SID的相关信息存储在注册表的受保护区域。

​	在用户每次登录系统时，系统都会为用户创建访问令牌，其中包含用户账户的SID，用户账户所属的用户组的SID，以及用户拥有的权限。

SID的相关信息存储在注册表的受保护区域中。

​	SID账户由多个“—”符号将整个SID分隔为多组字符和数字。

#### SID查看之CMD命令

```cmd
SID查看命令：
whoami/user
wmic useraccount get name,sid
```

#### SID查看之注册表

​	Win + R打开运行对话框，输入regedit，然后按回车。

​	在注册表编辑器中导航到以下路径：

```cmd
计算机\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList
```

​	在ProfileList下，可以看到多个子健，每个子键名称就是一个SID

​	计算机管理里面也可以看到

命令行管理账号与组
	net user 账号 密码  /add          创建一个账户（要有管理员权限）
	net user      查看所有用户账户
	net user ?         使用帮助
	net localgroup      查看组

Windows的进程和服务
	进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础
	服务管理：一项服务在其生存周期会经历几个内部状态。首先，服务会安装到它将在近其上运行的系统上。此过程执行服务项目的安装程序，并将服务加载到该计算机的服务控制管理器中。服务控制管理器是Windows提供的用于管理服务的中央实用程序。
	打开服务管理方式：运行框中（Win+R）输入services.msc
	命令行关于服务：net stop xxx(停止xxx服务），net start xxx（开始xxx服务），sc（系统给你一些关于sc的命令），sc qurery（查询服务的状态），sc queryex（查询服务的扩展状态）
	进程的命令行：tasklist /?（寻求关于tasklist关于的命令行帮助），tasklist（查看各个进程），tasklist /svc（查看每个进程及其服务），tasklist | findstr "xxx"（只看带有xxx关键字的进程）

端口
	Windows端口是计算机与外界通讯交流的出入口。逻辑意义上的端口一般是指TCP/IP协议中的端口。一个IP地址可以有65536个端口，端口用整数数字来标记，范围为0到65535。
	网络安全中通过端口可以判断主机的端口开放、服务版本、操作系统、系统漏洞等情况。同时利用端口进行正向绑定shell和反弹shell的情况也非常常见。
	按照协议类型有两种端口：TCP和UDP
	端口号也分为两种：周知端口（是众所周知的端口号，范围从0到1023，其中80端口分配给www服务，21端口分配给FIP服务，www服务的端口默认为80）和动态端口（范围从1024到65535，一般不固定分配某种服务，是动态分配）
																								动态分配：当一个系统进程或应用程序需要网络通信时，它向主机申请一个端口，主机分配一个可用的端口号
	端口的命令行：netstat（查看一些端口），netstat -ano（查看端口及其被那个进程占用），netstat -ano | findstr "xxx"（查看含有xxx关键字的端口），netstat -ano | findstr xx（整数）（查看xx端口，同时可以发现其运行在PID为多少的上）
				netstat -a（查看所有端口）				netstat ?（帮助）													接着输入tasklist | findstr xxx(PID)（用PID查看那个应用被占用了）













# 知了汇智2025年冬令营网络安全应急响应课程

## 操作系统

### PART 1: Windows 操作系统

#### Windows账号与组管理

用户是计算机中的主体，当用户向计算机发出指令时，计算机才会开始执行相应的操作。

用户账户代表用户在操作系统中的身份。用户在启动计算机并登录操作系统时，必须使用有效的用户账户才能进入操作系统。登录操作系统后，系统会根据用户账户的类型为用户分配相应的操作权利和权限，从而可以限制不同类型的用户所能执行的操作。

#### Windows账号类型

Windows操作系统用户账号分为如下3种类型：

- **管理员用户**：拥有对计算机的最高级别的操作权力和权限。
- **标准用户**：可以完成大量常规操作，但是不能进行可能会影响到系统稳定和安全的操作。
- **来宾用户**：可以在不需要用户账户和密码的情况下登录操作系统而临时使用计算机。

#### Windows账号类型

Administrator和Guest是Windows 10以及早期Windows版本中内建的两个用户账户，这两个用户账户在Windows 10中默认处于禁用状态，而且用户不能删除系统内建的用户账户。

1. **Administrator**  
   Administrator账户拥有对计算机的完全控制权限，不会受到任何限制（包括来自用户账户控制的限制），而且可以创建新的用户账户和组账户，并为账户分配权力和权限。

2. **Guest**  
   为了便于没有为其分配用户账户的用户临时使用计算机，系统提供了Guest来宾账户。即使没有为用户创建特定的用户账户，用户也可以使用Guest账户登录系统，但是所能执行的操作很有限，比如无法安装硬件和应用程序，也无法访问个人文件夹以及更改系统设置等。

#### Windows组账号

系统内置组账户  
为了便于为用户创建的用户账户快速设置权利和权限，系统内建了大量的组账户，用户可以使用其中的一些组账户，而另一些组账户则只能由系统使用，用于完成系统任务。用户无法删除系统内建的组账户。

1. Administrators  
2. Anonymous Logon  
3. Authenticated Users  
4. Backup Operators  
5. Everyone  
6. Guests  
7. Local Service  
8. Local System  
9. Network  
10. Network Service  
11. Owner Rights  
12. Power Users  
13. Users

#### 账号SID

SID是操作系统中的每个账户的“身份证明”。无论是系统内建的用户账户和组账户，还是由用户创建的用户账户和组账户，每个账户都有唯一的SID。在用户每次登录系统时，系统都会为用户创建访问令牌，其中包含用户账户的SID、用户账户所属的用户组的SID，以及用户拥有的权限。SID的相关信息存储在注册表的受保护区域中。

| SID     | 与SID对应的账户 | SID          | 与SID对应的账户     |
| ------- | --------------- | ------------ | ------------------- |
| S-1-0-0 | Null            | S-1-5-11     | Authenticated Users |
| S-1-1-0 | Everyone        | S-1-5-18     | Local System        |
| S-1-2-0 | Local           | S-1-5-19     | Local Service       |
| S-1-3-0 | Creator Owner   | S-1-5-20     | Network Service     |
| S-1-5-1 | Dialup          | S-1-5-32-544 | Administrators      |
| S-1-5-2 | Network         | S-1-5-32-545 | Users               |
| S-1-5-4 | Interactive     | S-1-5-32-546 | Guests              |
| S-1-5-6 | Service         | S-1-5-32-547 | Power Users         |
| S-1-5-7 | Anonymous Logon | S-1-5-32-551 | Backup Operators    |

#### 账号SID

Administrators组账户的SID为S-1-5-32-544，由4个“-”符号将整个SID分隔为5组字符和数字，其中：

- 字母S表示该串字符是一个SID；
- 数字1表示SID的修订级别；
- 数字5表示SID的颁发机构，5代表NT Authority；
- 数字32表示SID的域标识符，32代表“内置”；
- 数字544表示SID的相对标识符，544代表Administrators。

由用户创建的用户账户的SID的组成结构与系统内置账户的SID类似，但是SID的长度通常会更长。例如，下面就是一个由用户创建的用户账户的SID。

S-1-5-21-2319384204-2662211735-595857245-1001

**SID查看命令：**

whoami /user
wmic useraccount get name,sid

#### 账号SID

打开注册表编辑器：按 Win + R 打开运行对话框，输入 regedit，然后按回车。  
导航到用户配置文件列表：在注册表编辑器中，导航到以下路径：  

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList

查看 SID：在 ProfileList 下，你会看到多个子键，每个子键的名称就是一个用户的 SID。点击每个子键，可以在右侧窗格中看到 ProfileImagePath，它显示了对应的用户配置文件路径，从而帮助你确定哪个 SID 对应哪个用户。

#### 图形化界面管理账号

1. 右击【开始】按钮，然后在弹出的菜单中选择【计算机管理】命令。
2. 打开【计算机管理】窗口，在左侧窗格中依次展开【系统工具】→【本地用户和组】节点，然后选择其中的【用户】选项，中间窗格中显示了系统中包含的内建账户和管理员创建的账户。在空白处右键，点击【新用户】从而创建用户。在前景图中输入用户的相关数据→单击创建按钮。

#### 图形化界面管理账号

3. 用户账户建立好后，请注销，然后单击此新账户，以便练习利用此账户来登录。完成练习后，再注销，改用Administrator登录。

#### 图形化界面管理组账号

1. 重新打开图中的【计算机管理】窗口，选中组然后右击，选择【新建组】命令。

#### 图形化界面管理组账号

2. 打开如图所示的【新建组】对话框，在【组名】文本框中输入组的名称，然后可以在【描述】文本框中输入有关组的用途的简要说明。
3. 单击【创建】按钮，然后单击【关闭】按钮关闭【新建组】对话框，新建的组将会显示在中间窗格中。

#### 用户添加至管理账号组

1. 打开【计算机管理】窗口，在左侧窗格中依次展开【系统工具】→【本地用户和组】节点，然后选择其中的【组】。在中间窗格中右击要向其添加用户的组，如Administrators组，然后在弹出的菜单中选择【添加到组】命令。
2. 打开如图所示的对话框，在【成员】列表框中显示了目前属于该组的用户。如果要向该组中添加其他用户，则单击【添加】按钮。

#### 用户添加至管理账号组

3. 打开【选择用户】对话框，可以直接在文本框中输入要添加的用户账户的名称。如果不记得名称的正确拼写，那么可以单击【高级】按钮，在展开的对话框中单击【立即查找】按钮。在下方的列表框中选择要添加的用户账户，如图所示。

#### 用户添加至管理账号组

4. 输入或选择好要添加的用户以后，单击【确定】按钮返回第二步中的组属性对话框，所选用户将会被添加到【成员】列表框中，表示该用户已被添加到该组中。下次使用该用户账户登录系统时，该设置即可生效。此后该用户将具有Administrators组所拥有的所有权力和权限。

如果不再需要某个用户从属于指定的组，那么可以将该用户从指定的组中删除，删除后该用户将不再具有该组的所有权力和权限。在【计算机管理】窗口的左侧窗格中依次展开【系统工具】→【本地用户和组】节点并选择其中的【组】，然后双击中间窗格中包含要从中删除用户的组，在打开的对话框的列表框中选择要删除的用户，单击【删除】按钮后即可将该用户从组中删除。

#### 命令行管理账号与组

管理计算机账户将使用命令“net user”，其可以对账户进行创建、删除等操作。而命令“net localgroup”则可用于组的查看、创建、删除，还可以将账户加入到指定的组当中（加入管理员组需要响应权限）。

在渗透Windows操作系统时，当黑客拿到shell以后首先会使用相关命令查看所处于的用户与组，从而检查所拥有的的权限，然后才经过“系统授权”拿到管理员执行权限并创建用户。

#### 命令行管理账号与组

添加账号ahl,密码为123，并删除：

C:\Windows\system32>net user ah1 123 /add
命令成功完成。

C:\Windows\system32>net user ah1
用户名 ah1
全名
注释
用户的注释
当用户/地区代码 000（系统默认值）
帐户启用 Yes
帐户到期 从不

上次设置密码 2025/1/12 22:56:40
密码到期 2025/2/23 22:56:40
密码可更改 2025/1/12 22:56:40
需要密码 Yes
用户可以更改密码 Yes

允许的工作站 A11
登录脚本
用户配置文件
主目录
上次登录 从不

C:\Windows\system32>net user ah1 456
命令成功完成。

C:\Windows\system32>net user ah1 /del
命令成功完成。

#### 命令行管理账号与组

## C:\Windows\system32>net localgroup \DESKTOP-UTIO6B1 的别名

Access Control Assistance Operators
Administrators
Backup Operators
Cryptographic Operators
Distributed COM Users
Event Log Readers
Guests
Hyper-V Administrators
IIS_IUSRS
Network Configuration Operators
Performance Log Users
Performance Monitor Users
Power Users
Remote Desktop Users
Remote Management Users
Replicator
System Managed Accounts Group
Users

## C:\Windows\system32>net localgroup marketingroup /add 命令成功完成。

## C:\Windows\system32>net localgroup marketingroup 别名 marketingroup 注释 成员

## 命令成功完成。

## C:\Windows\system32>net localgroup marketingroup /del 命令成功完成。

C:\Windows\system32>net localgroup "remote desktop users" ahl /add

#### Windows服务与进程

进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。

操作系统将硬件管理起来，提供统一管理接口供用户调用。操作系统提供一个平台，进程则在平台上完成相应的操作(比如听音乐、看电影、编辑word文档等等)。在现代的操作系统中，操作系统支持多进程，即现代操作系统支持多个进程同时运行。

多核的情况和单核的情况相似，也是采用“分时”的方法。只不过是多核有多个处理器。这里可以把每个核想象为一个个单核就可以了。

在操作系统启动的时候，需要先把进程的运行环境全部创建起来，为进程的运行打好基础。创建一个进程即为进程建立基本的执行环境，然后将其加入到系统的全局进程表中，这样进程就能获得相应的资源来运行。

#### 服务管理

一项服务在其生存期内会经历几个内部状态。首先，服务会安装到它将在其上运行的系统上。此过程执行服务项目的安装程序，并将该服务加载到该计算机的服务控制管理器中。服务控制管理器是 Windows 提供的用于管理服务的中央实用程序。

打开windows系统的系统服务，方法如下：

1. 在电脑桌面，右键点击【我的电脑】，选择【管理（G）】。或者在运行对话框的输入框“services.msc”并按回车键或者点击【确定】按钮继续，如图所示。

#### 服务管理

2. 在“计算机管理器”对话框，依次点击【本地服务器】→【服务】，页面右侧打开即服务管理器列表。如图所示。打开服务管理器查看服务列表启动、停止服务。

#### 服务管理

通过命令行方式管理Windows服务。

- **net命令方式**  
  格式：启动和关闭服务的时候，其语法是：

net start 服务名。
net stop 服务名。

- **sc命令方式**  
SC是用来与服务控制管理器和服务进行通信的命令行程序。SC命令的语法如下：

sc <server> [command] [service name] <option1><option2>...>

#### 服务管理

- **sc命令参数**

| 选项    | 含义                                       |
| ------- | ------------------------------------------ |
| query   | 查询服务的状态，或枚举服务类型的状态。     |
| queryex | 查询服务的扩展状态，或枚举服务类型的状态。 |
| start   | 启动服务。                                 |
| stop    | 向服务发送STOP请求。                       |

#### 服务管理

- **sc命令参数**

| 选项    | 含义                                       |
| ------- | ------------------------------------------ |
| query   | 查询服务的状态，或枚举服务类型的状态。     |
| queryex | 查询服务的扩展状态，或枚举服务类型的状态。 |
| start   | 启动服务。                                 |
| stop    | 向服务发送STOP请求。                       |

#### 进程管理

在Windows系统中，同时按下Ctrl+Alt+Del键，在弹出的界面中，单击任务管理器选项。然后，进入如图所示界面，可以选择指定的进程，结束进程。

#### 进程管理

- **tasklist查看进程**  
Windows系统中进程的管理还可以使用命令“tasklist”。该命令是一个用来显示运行在本地或远程计算机上的所有进程的命令行工具，带有多个执行参数。  

Tasklist的作用是结束一个或多个任务或进程。可以根据进程ID或图像名来结束进程。  

语法格式：

TASKLIST [/s system[/U username[/P[password]]]]-[/M[module]]/SVC[/V][/FI filter]/FO format[/NH]-

运行“cmd”，在提示符窗口中输入：“tasklist”命令，这样就显示本机的所有进程。本机的显示结果由五部分组成：映像名称（进程名）、PID、会话名、会话#、内存使用。如图所示。

#### 进程管理

- **tasklist查看进程**  
  Tasklist命令不但可以查看系统进程，而且还可以查看每个进程提供的服务。在命令提示符下输入：“tasklist /svc”，这样就列出了每个进程所调用的服务。如图所示。

#### 进程管理

- **tasklist查看进程**  
  使用DOS提供的管道命令“|”与“findstr”可根据关键字筛选出指定的进行情况，例如：使用命令tasklist | findstr “cmd”可以筛选出cmd关键字的相关的进程情况，如下图所示。

Tasklist命令还支持远程查看对端主机的进程列表，其可以查看局域网内任何一台已经启动RPC服务主机的进程，从而实现简单的网络主机监控，如下图所示。

#### 进程管理

- **tasklist关闭进程**  
  Windows进程管理中taskkill命令用于结束进程，是与tasklist命令配套使用的一个程序。

格式：taskkill/f/t/fi "imagenameeq cmd.exe"

参数说明：

- /f 强行终止进程。
- /t 终止指定的进程和由它启用的子进程。如果一个cmd中正在执行另一个程序，比如adb logcat，那么如果使用taskkill关闭这个cmd时不加/t，adb logcat就继续执行，不会被关闭。
- /fi 指定筛选器。/fi "imagename eq cmd.exe" 筛选映像名为cmd.exe的进程，相当于/im "cmd.exe"。

#### 端口概念

Windows端口是计算机与外界通讯交流的出入口。逻辑意义上的端口一般是指TCP/IP协议中的端口。如果把IP地址比作一间房子，端口就是出入这间房子的门。真正的房子只有几个门，但是一个IP地址的端口可以有65536个之多。端口是通过端口号来标记的，端口号只有整数，范围是从0到65535。

端口为主机服务带来了访问便利的同时，也为黑客提供了渗透进入主机的更多窗口。网络安全中通过端口可以判断对端主机的端口开放、服务版本、操作系统、系统漏洞等情况。同时利用端口进行正向绑定shell和反弹shell的情况也非常多见。

#### 端口分类与状态

按对应的协议类型，端口有两种：TCP端口和UDP端口。由于TCP和UDP两个协议是独立的，因此各自的端口号也相互独立，比如TCP有235端口，UDP也可以有235端口，两者并不冲突。

对于TCP端口而言，由于TCP连接的“三次握手”特性，该端口将根据其处于的TCP连接状态的阶段分为几种状态。

| LISTEN      | 目前主机正等待其他主机进行连接                |
| ----------- | --------------------------------------------- |
| ESTABLISHED | 目前主机已经与其他主机建立连接                |
| TIME-WAIT   | 等待足够的实践来确保远程TCP接受到连接中断请求 |
| CLOSED      | 没有任何连接状态                              |

#### 端口分类与状态

与IP地址一样，端口号也不是随意使用的，而是按照一定的规定进行分配。

1. **周知端口（Well Known Ports）**  
   周知端口是众所周知的端口号，范围从0到1023, 其中80端口分配给www服务, 21端口分配给FTP服务等。我们在IE的地址栏里输入一个网址的时候（比如www.baidu.com）是不必指定端口号的，因为在默认情况下www服务的端口号是“80”。

2. **动态端口（Dynamic Ports）**  
   动态端口的范围是从1024到65535之所以称为动态端口，是因为它一般不固定分配某种服务，而是动态分配。动态分配指当一个系统进程或应用程序进程需要网络通信时，它向主机申请一个端口，主机从可用的端口号中分配一个供它使用。

#### 查看端口状态

能查看系统主机端口是安全管理员的必备技能，通过端口的监听情况往往能够判定一些可疑的端口与进程，然后对可以程序进行处理。在分析过程中要查看系统的周知端口和动态端口的连接情况。

Windows系统中可以使用netstat命令查看端口状态情况，该命令与Linux类似，其用于显示系统中网络相关信息，如：网络连接、路由表、端口状态等。

| -a   | 显示所有活动的 tcp 连接，以及计算机监听的 tcp 和 udp 端口。  |
| ---- | ------------------------------------------------------------ |
| -e   | 显示以太网发送和接收的字节数、数字包数等统计信息。           |
| -n   | 网络IP地址代替名称，显示出网络连接情形，显示所有已建立的有效连接。 |
| -o   | 显示活动的tcp连接并包括每个连接的进程pid。                   |
| -s   | 按协议显示各种连接的统计信息，包括端口号，此选项可以与 -s 选项结合使用。 |
| -r   | 显示核心路由表，格式同“route -e”。本选项可以显示关于路由表的信息。 |
| -p   | 显示指定协议信息。显示协议名查看某协议使用情况。             |

#### 查看端口状态

Windows查看端口的案例。在命令行提示符窗口中输入“netstat -an”，然后按回车键，查看服务器上所有打开的端口，如图所示。

#### 查看端口状态

当输入命令“netstat -ano”时，可以查看该端口被哪个进程所占用，如图所示。

#### 根据端口查找程序

在命令行中输入命令如：netstat -ano | findstr 80，查看80端口，是否被占用，其中findstr是查找指定的一个或多个文件文件中包含某些特定字符串的行，如图所示。可以发现使用TCP协议且为80端口的程序运行在PID为600上。

然后，输入命令tasklist | findstr 600，用pid查看被哪个应用占用了，可以发现该600进行上运行了我们本不想开启的http.exe应用程序。

C:\Users\an.an-PC\tasklist | findstr 600
Httpd.exe 600 Console 1 17,724 K

### PART 2: Linux操作系统

#### Linux账号与组基础概念

用户和组是Linux操作系统里面进行操作、文件管理和资源使用的主体，它们在操作系统中作为不同的角色存在。在通常的安全威胁中，黑客经常会通过创建一些非法用户并获取非法权限，从而对系统资源和数据进行滥用和破坏。因此，保护用户和组管理安全是Linux系统安全非常重要的一个方面。

在Linux操作系统中，每一个文件和程序都归属于一个特定的“用户”。每一个用户都由一个唯一的身份来标识，这个标识叫做用户ID（UserID, UID）。并且，系统中的每一个用户也至少需要属于一个“用户分组”，即由系统管理员所建议的用户小组，这个小组中包含着许多系统用户。与用户一样，用户分组也是由一个唯一的身份来标识的，该标识叫做用户分组ID（GroupID, GID）。用户可以归属于多个用户分组。对某个文件或程序的访问是以它的UID和GID为基础的。

#### Linux账号与组基础概念

用户和组有如下几种对应关系：

- **一对一** 某个用户可以是某个组的唯一成员。
- **多对一** 多个用户可以是某个唯一的组的成员，不归属其他用户组。
- **一对多** 某个用户可以是多个用户组的成员。
- **多对多** 多个用户对应多个用户组，并且几个用户可以是归属相同的组。

每个用户的权限可以被定义为普通用户和根用户。

- **普通用户** 只能访问其拥有的或者有权跟执行的文件。
- **根用户（root）** 能够访问系统全部的文件和程序，而不论根用户是否是这些文件和程序的所有者。根用户通常也被称为“超级用户”，其权限是系统中最大的，可以执行任何操作。

#### Password用户账号文件

/etc/passwd文件是UNIX安全的关键文件之一。该文件用于用户登录时校验用户的登录名（LOGNAME）、加密的口令数据项（PASSWORD）、用户ID（UID）、默认的用户分组ID（GID）、用户信息（USERINFO）、用户登录子目录以及登录后使用的Shell（SHELL）。这个文件的每一行保存一个用户的资料，而用户资料的每一个数据项采用冒号“：”分隔，如下所示：

LOGNAME: PASSWORD: UID: GID: USERINFO: HOME: SHELL

每行的头两项是登录名和加密后的口令，后面的两个数是UID和GID，接着的一项是系统管理员想写入的有关该用户的任何信息，最后两项是两个路径名：一个是分配给用户的HOME目录，另一个是用户登录后将执行的Shell（若为空格则默认为/bin/sh）。

#### Password用户账号文件

Linux操作系统用户实例，用户名为Micle。

Micle: x: 1000: 1000: This is a WorkerAccount /home/Micle/bin/bash;

该用户的基本信息如下：

- 登录名：Micle;
- 加密后的口令表示：x;
- UID：1000;
- GID：1000;
- 用户信息：This is a WorkerAccount;
- HOME目录：/home/Micle;
- 登录后执行的Shell：/bin/bash。

用户的登录名是用户用来登录的识别，由用户自行选定，主要由方便用户记忆或者具有一定含义的字符组成，要保证用户名的唯一性。

#### Password用户账号文件

在安全检查中需要着重注意该文件的权限，默认情况下/etc/passwd权限为0644。使用命令“stat /etc/passwd”进行检查，如果该文件的权限和属主发生了变化，则可能代表发生了异常情况（例如误操作或入侵事件），需引起注意。

root@localhost~]# stat /etc/passwd
File: '/etc/passwd'
Size: 929 Blocks: 8 IO Block: 4096 regular file
Device: fd00h/647684 Inode: 4301727 Links: 1
Access: (0644/rw-r--) Uid: ( 0/ root) Gid: ( 0/ root)
Access: 2021-01-24 11:32:11.816128008-0500

#### Shadow用户影子文件

Linux使用不可逆的加密算法如DES来加密口令，由于加密算法是不可逆的，所以黑客从密文是得不到明文的。但/etc/passwd文件是全局可读的，加密的算法是公开的，恶意用户获取了/etc/passwd文件后，便极有可能破解口令。而且，在计算机性能日益提高的今天，对账户文件进行字典攻击的成功率会越来越高，速度越来越快。因此，针对这种安全问题，Linux/UNIX广泛采用了“shadow（影子）文件”机制，将加密的口令转移到/etc/shadow文件里，该文件只为root超级用户可读，而同时/etc/passwd文件的密文域显示为一个x，从而最大限度地减少了密文泄露的机会。

/etc/shadow文件的每行是个冒号分隔的9个域，格式如下：

username: passwd: lastchg: min: max: warn: inactive: expire: flag:

#### Shadow用户影子文件

/etc/shadow文件域名含义

| 域名     | 含义                                                         |
| -------- | ------------------------------------------------------------ |
| username | 用户登录名                                                   |
| passwd   | 加密的用户口令                                               |
| lastchg  | 最后一次修改时间：表示从1970年1月1日起到上次修改口令所经过的天数 |
| min      | 最小修改时间间隔：表示两次修改口令之间至少经过的天数         |
| max      | 密码有效期：表示口令还会有效的最大天数，如果是9999则表示永不过期 |
| warn     | 密码需要更改前警告天数：表示口令失效前多少天内系统向用户发出警告 |
| inactive | 密码过期后的宽限天数                                         |
| expire   | 账户失效时间：表示用户被禁止登录的时间                       |
| flag     | 保留域，暂未使用                                             |

#### 组账号文件group

/etc/passwd文件中包含着每个用户默认的分组ID（GID）。在/etc/group文件中，这个GID被映射到该用户分组的名称以及同一分组中的其他成员中去。

/etc/group文件含有关于小组的信息，/etc/passwd中每个GID在文件中应当有相应的入口项，入口项中列出了小组名和小组中的用户，这样可方便地了解每个小组的用户，否则必须根据GID在/etc/passwd文件中从头至尾地寻找同组用户，提供了一个比较快捷的寻找途径。/etc/group文件对小组的许可权限的控制并不是必要的，因为系统用来自于/etc/passwd文件的UID、GID来决定文件存取权限，即使/etc/group文件不存在于系统中，具有相同的GID用户也可以小组的存取许可权限共享文件。小组就像登录用户一样可以有口令。如果/etc/group文件入口项的第二个域为非空（通常用x表示），则将被视为是加密口令。

#### 组账号文件group

/etc/group文件中每一行的内容如下所示。

- 用户分组名
- 加过密的用户分组口令
- 用户分组ID号（GID）
- 以逗号分隔的成员用户清单

如同用户账号文件的作用一样，组账号文件也是为了加强组口令的安全性，防止黑客对其实行的暴力攻击，而采用的一种将组口令与组的其他信息相分享的安全机制。其格式包括如下所示内容。

- 用户组名
- 加密的组口令。
- 组成员列表

#### 新增账号

添加用户的命令有useradd和adducer两个，这两具命令所达到的目的和效果都是一样的。在Fedora发行版中，useradd和adducer用法是一样的；但在slackware发行版本中，adducer和useradd还是有所不同，表现为adducer是以人机交互的提问方式来添加用户。除了useradd和adducer命令外，用户还能通过修改用户配置文件/etc/passwd和/etc/groups的办法来实现。

使用useradd命令添加用户或更新创建用户的默认信息，这些默认信息包括前面所讲述的用户账户文件所存储的用户相关信息。

#### 新增账号

该命令的使用格式为：useradd 新用户名

该命令所使用的选项包括：

- c comment: 描述新用户账号，通常为用户全名
- d home_dir: 设置用户主目录，默认值为用户的登录名，并放在/home目录下
- D: 创建新账号后保存为新账号设置的默认信息
- e expire_date: 用YYYY-MM-DD格式设置账号注册日期
- f inactivity: 设置口令失效时间。inactivity值为0时，口令失效后账号立即失效
- g: 设置基本组
- k框架目录: 设置框架目录，该目录包含用户的初始配置文件，创建用户时该目录下的文件都被复制到用户主目录下
- m: 自动创建用户主目录，并把框架目录（默认为/etc/skel）下的文件复制到用户主目录下
- M: 不创建用户主目录
- T: 允许保留的系统账号，使用用户ID创建一个新账号
- s shell类型: 设定用户使用的登录shell类型
- u 用户ID: 设置用户ID

#### 新增账号

由于系统安全考虑，Linux系统中的每一个用户除了有其用户名外，还有其对应的用户口令。因此使用useradd命令增加账户时，还需要password命令为每一位新增的用户设置口令。用户以后还可以随时使用password命令改变用户的口令。

password命令的一般格式为：passwd 【用户名】。其中用户名为需要修改口令的用户名。只有超级用户可以使用“passwd 【用户名】”修改其他用户的口令，普通用户只能用不带参数的password命令修改自己的口令。设置口令时应该保证至少有6位字符，并且口令中应该包括大小写字母、数字、特殊字符等，尽量不要采用字典上的单词，以降低被黑客使用“字典攻击”成功的概率。

#### 删除账号

userdel命令用来删除系统中的用户。该命令的使用格式为：userdel 选项 用户名。该命令的选项如下。

- [ ] 删除账号时，连同账号主目录一起删除  
下图给出了使用userdel命令删除用户david的例子，并使用id命令查看删除是否成功。

#### 进程管理

ps是Linux下最常用的进程监控命令，它能列出系统中运行的进程，包括：进程号、命令、CPU使用量、内存使用量等信息。

常用参数：

| -A   | 所有进程均显示出来。                |
| ---- | ----------------------------------- |
| -a   | 列出不与终端有关的所有进程。        |
| -u   | 列出有效用户的进程。                |
| X    | 通常与a参数连用，列出较完整的信息。 |
| J    | 工作的格式。                        |
| -f   | 更完整的信息输出。                  |

#### 进程管理

举例：ps查看自己的bash相关进程。

root@localhost ~]# ps -1
FS UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD
4S 0 3834 3832 0 80 0 - 28894 do_wai pts/1 00:00:00 bash
4S 0 3852 3834 0 80 0 - 28894 do_wai pts/1 00:00:00 bash
OR 0 4300 3852 0 80 0 - 37247 - pts/1 00:00:00 ps

举例：ps查看系统所有进程。

root@localhost ~]# ps aux
USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND
root 1 0.0 0.3 125408 3856 ? Ss Dec21 0:04
/usr/lib/systemd/systemd --switched-root --system --deserialize 21
root 2 0.0 0.0 0 0 ? S Dec21 0:00 [kthreadd]
root 3 0.0 0.0 0 0 ? S Dec21 0:01 [ksoftirdd/0]

#### 进程管理

top命令是监控系统进程必不可少的工具，与ps相比，top命令动态、实时的显示进程状态，而ps只能显示进程某一时刻的信息。同时，top命令提供了一个交互界面，用户可以根据需要，人性化的定制自己的输出，更清晰的了解进程的实时状态。

常用参数：

| -d   | 指定整个进程界面更新的秒数，默认是5秒                |
| ---- | ---------------------------------------------------- |
| -b   | 以批次的方式执行top，搭配参数n使用，将结果输出成文件 |
| -n   | 与参数b搭配使用，指定进行几次top输出结果             |
| -p   | 指定监测某些PID                                      |

top执行过程中可以使用的按键命令

| ?    | 显示在top当中可以输入的按键命令   |
| ---- | --------------------------------- |
| P    | 以CPU的使用资源排序显示           |
| M    | 以内存的使用资源排序显示          |
| N    | 以PID来排序                       |
| T    | 由该进程使用的CPU实践累积时间排序 |
| Q    | 离开top界面                       |

#### 进程管理

pstree指令可以显示程序和进程之间的关系，如果不指定进程的PID号，或者不指定用户名称，则将以Systemd进程为根进程，显示系统的所有程序和进程信息。

语法：pstree [=script] [<PID>/<user>]

常用参数：

| -a   | 显示启动每个进程对应的完成指令，包含启动进程的路径、参数等 |
| ---- | ---------------------------------------------------------- |
| -c   | 不使用精简法显示进程信息，即显示的进程中包含子进程和父进程 |
| -n   | 根据PID号来排序输出，默认是以程序名称排序输出              |
| -p   | 显示PID号                                                  |
| -u   | 显示进程对应的用户名称                                     |
| PID  | 进程对应的PID号                                            |
| User | 系统用户名                                                 |

#### 进程管理

举例：显示root用户下对应的进程信息。

[root@localhost ~]# pstree root
systemd--- NetworkManager ---dhelient //本行与下一行都为NetworkManager分出来的子进程
---2*[[NetworkManager]] //相似进程用数字表示
---auditd ---{auditd}
---省略
---systemd-logind
---systemd-udevd
---tuned ---4*





举例：pstree的其他监控案例。

[root@localhost ~]# pstree -c -p root //显示root用户下父进程与子进程的PID
[root@localhost ~]# pstree -u 1039 //显示1039进程下的详细情况
sshd ---sshd
---bash ---pstree
---sshd
[root@localhost ~]# pstree -A //查看所有进程树

#### 进程管理

pgrep是通过程序的名称来查询进程PID的工具，它通过检查程序在系统中活动的进程输出进程属性匹配命令行上指定条件的进程ID。每个进程ID以十进制数表示，通过一个分割字符串和下一个ID分开，这对于判断程序是否正在运行，或者要迅速了解进程PID的需求来说非常有用。

语法：pgrep [-lonf…] [指令]

常用参数：

| -1   | 列出程序名和进程值                   |
| ---- | ------------------------------------ |
| -o   | 用来显示进程起始的进程ID             |
| -n   | 用来显示进程终止的进程ID             |
| -f   | 用来匹配指令中的关键字，即字符串匹配 |

#### 进程管理

举例：查看ssh服务进程ID。

[root@localhost ~]# pgrep -l ssh //查看ssh进程的程序名与进程ID
1039 sshd
5925 sshd
[root@localhost ~]# pgrep -lo sshd //查看ssh进程的起始ID
1039 sshd
[root@localhost ~]# pgrep -ln sshd //查看ssh进程的终止ID
5925 sshd
[root@localhost ~]# pgrep -f sshd //查看ssh进程的所有ID
1039
5925
[root@localhost ~]# pgrep -u root -l ssh //查看用户名为root进程名为ssh的进程ID
1039 sshd
5925 sshd

#### 进程管理

lsof全名为list opened files，它是一个列出当前系统已打开文件的工具。在Linux环境中任何事物都以文件的形式存在，通过文件不仅可以访问常规数据，还可以访问网络连接和硬件。

常用参数：

| -c   | 列出指定进程打开的文件     |
| ---- | -------------------------- |
| -p   | 列出指定进程号所打开的文件 |

#### 进程管理

举例：显示某文件的进程。如果想了解某个特定的文件被哪个进程使用，可以通过“lsof文件名”的方式查看。使用lsof查看/var/log/messages文件被使用的进程，从输出可知，该文件是由rsyslogd进程使用，该进程PID为666，使用的用户为root。

[root@localhost ~]# lsof /var/log/messages
COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME
rsyslogd 666 root 6w REG 253,0 498534 4960308 /var/log/messages

举例：通过进程号显示程序打开的所有文件及相关进程。想知道systemd进程打开了哪些文件，可以执行“lsof -p 1”命令查看该进程打开文件。

[root@localhost ~]# lsof -p 1
COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME
systemd 1 root cwd DIR 253,0 244 64 /
systemd 1 root rtd DIR 253,0 244 64 /
systemd 1 root txt REG 253,0 1523568 4309403 /usr/lib/systemd/systemd

#### 进程管理

通常终止一个前台进程可以使用Ctrl+C组合键。但是，对于一个后台进程就需要用kill命令来终止。kill命令是通过向进程发送指定信号来结束相应进程。

语法：kill [信号类型] 进程PID

常用信号类型：

| 9    | 强制结束进程                                                 |
| ---- | ------------------------------------------------------------ |
| 2    | 结束进程，但不是强制性的，常用的ctrl+c组合键发出的就是2类型的信号 |
| 15   | 正常结束进程，该类型是kill的缺省选项，kill不加任何类型结束进程使用的就是该类型。 |

举例：使用kill正常结束apache子进程与父进程。

[root@localhost cron]# ps -ef | grep httpd
root 7344 1 0 17:36 ? 00:00:00 /usr/sbin/httpd -DFORECROUND
apache 7345 7344 0 17:36 ? 00:00:00 /usr/sbin/httpd -DFORECROUND
apache 7346 7344 0 17:36 ? 00:00:00 /usr/sbin/httpd -DFORECROUND
apache 7347 7344 0 17:36 ? 00:00:00 /usr/sbin/httpd -DFORECROUND
apache 7348 7344 0 17:36 ? 00:00:00 /usr/sbin/httpd -DFORECROUND
apache 7349 7344 0 17:36 ? 00:00:00 /usr/sbin/httpd -DFORECROUND
root 7380 5927 0 17:38 pts/0 00:00:00 grep --color=auto httpd
[root@localhost cron]# kill 7346 //杀掉子进程7346
[root@localhost cron]# kill 7344 //杀掉父进程7344

#### 进程管理

举例：使用kill强制结束apache父进程。

[root@localhost cron]# kill -9 7440 //强制杀掉apache父进程7440
[root@localhost cron]# ps -ef | grep httpd //查看httpd子进程
apache 7441 1 0 17:55 ? 00:00:00 /usr/sbin/httpd -DFOREGROUND
apache 7442 1 0 17:55 ? 00:00:00 /usr/sbin/httpd -DFOREGROUND
apache 7443 1 0 17:55 ? 00:00:00 /usr/sbin/httpd -DFOREGROUND
apache 7444 1 0 17:55 ? 00:00:00 /usr/sbin/httpd -DFOREGROUND
apache 7445 1 0 17:55 ? 00:00:00 /usr/sbin/httpd -DFOREGROUND
root 7451 5927 0 17:55 pts/0 00:00:00 grep --color=auto httpd

上述操作通过“kill -9 7440”强制关闭了apache的父进程，这时由于父进程被强制关闭导致子进程并没有因父进程的关闭而自动关闭，子进程已经变成了孤儿进程。为了能让孤儿进程的资源得以释放，系统默认将systemd进程作为孤儿进程的父进程。